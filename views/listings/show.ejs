<style>
  #map {
    width: 100%;
  }

  .share{
    margin-right: 25px;
    margin-top: 10px;
  }

  .share a{
    font-size: 15px;
    padding: 3px 5px;
    border-radius: 5px;
    transition: all 0.3s;
  }
  
  .share a:hover{
    background-color: #d8dde1;
  }

  .feature-icon {
    font-size: 1.5rem;
    color: #2e2e2e;
  }

  .details {
    flex: 2;
    padding: 20px;
  }

  .details h1 {
    font-size: 24px;
    margin: 0;
  }

  .host-info {
    display: flex;
    align-items: center;
  }

  .host-info img {
    border-radius: 50%;
    width: 50px;
    height: 50px;
    margin-right: 10px;
  }
  

  /* Delete button style */
  .btn-danger {
    background-color: #e74c3c;
    border-color: #e74c3c;
  }

  .btn-danger:hover {
    background-color: #c0392b;
    border-color: #c0392b;
  }

  .gallery-pic {
    display: flex;
    padding: 5px;
  }

  .gallery {
    width: 350px;
    height: 200px;
    padding: 10px;
    transition-duration: 0.5s;
    cursor: pointer;
  }
  .galleryOne {
    width: 550px;
    height: 400px;
    border: 5px solid #ff385d38;
    border-radius: 10px;
    transition-duration: 0.5s;
    cursor: pointer;
  }

  .gallery:hover {
    opacity: 0.80;
  }
  .galleryOne:hover {
    opacity: 0.80;
  }

  .container2 {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
  }

  /*Review Modal Box */
  .modal-dialog {
    max-width: 100%; /* Adjust width as needed */
    width: 100%;
    margin: 0 auto; /* Center horizontally */
    position: absolute; /* Take it out of the flow */
    top: -10% !important; /* Move down by half the height of the viewport */
    left: 15% !important; /* Move right by half the width of the viewport */
  }

#reviews-modal .modal-content {
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

#reviews-modal .modal-header {
  background-color: #f7f7f7;
  border-bottom: 2px solid #ddd;
  border-top-left-radius: 15px;
  border-top-right-radius: 15px;
}

#reviews-modal .modal-title {
  font-weight: bold;
}

.review-card {
  transition: transform 0.3s ease;
}

.review-card:hover {
  transform: scale(1.05);
}

.card-text {
  font-size: 0.9rem;
}

.show-more {
  font-size: 0.9rem;
  text-decoration: underline;
  cursor: pointer;
}

.show-more:hover {
  color: #007bff;
}

/* Pagination styling */
#reviews-modal .btn {
  font-weight: bold;
}


  /*Image Modal */
  .modal {
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.8);
    display: none;
    justify-content: center;
  }

  .modal-content {
    position: relative;
    margin-top: 80px;
    max-width: 70%;
    max-height: 80%;
    text-align: center;
  }

  .modal-content img {
    max-width: 100%;
    max-height: 100%;
  }

  .modal-content .close {
    position: absolute;
    top: 10px;
    right: 20px;
    color: white;
    font-size: 28px;
    cursor: pointer;
    transition: 0.5s;
  }
  .modal-content .close:hover{
    color: #d12815;
  }

  .nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    font-size: 50px;
    color: white;
    cursor: pointer;
    z-index: 2;
    user-select: none;
  }

  #prevBtn {
    left: 10px;
    padding: 3px 10px;
    border-radius: 5px;
    transition: 0.3s;
  }
  #prevBtn:hover {
    background-color: #5e5d5d91;
  }

  #nextBtn {
    right: 10px;
    padding: 3px 10px;
    border-radius: 5px;
    transition: 0.3s;
  }
  #nextBtn:hover {
    background-color: #5e5d5d91;
  }

  @media (max-width: 768px) {
    .display-4 {
      font-size: 1.8rem;
    }
    .btn-lg {
      font-size: 1rem;
      padding: 0.8rem 1.5rem;
    }
    .review-card {
      margin-bottom: 20px;
    }
  }

  @media (max-width: 576px) {
    .card .card-img-top {
      max-height: 300px;
    }
    .btn-lg {
      font-size: 0.9rem;
      padding: 0.4rem 1rem;
    }
    .button{
      display: flex;
    }
    .reviews .card {
      padding: 1rem;
    }
  }

  .review-card {
    border: 1px solid #ddd;
    border-radius: 10px;
    background-color: rgba(240, 235, 235, 0.564);
    border: 1px solid rgba(255, 255, 255, 0.089);
  }


  .reservation-card {
    box-shadow: rgba(0, 0, 0, 0.4) 0px 2px 4px, rgba(0, 0, 0, 0.3) 0px 7px 13px -3px, rgba(0, 0, 0, 0.2) 0px -3px 0px inset;
    padding: 20px;
    max-width: 400px;
    max-height: 500px;
    margin: 50px auto;
  }

  .reservation-card .dates{
    padding: 10px;
    border: 1px solid #545454;
    border-radius: 10px;
  }

  .reservation-card .price {
    font-size: 24px;
    font-weight: bold;
    color: #d32f2f;
  }

  .reservation-card .price-discount {
    text-decoration: line-through;
    font-size: 18px;
    color: #6c757d;
    margin-right: 5px;
  }

  .reservation-card .btn-reserve {
    background: linear-gradient(90deg, #ff5a5f, #ff385c);
    color: #fff;
    border: none;
    padding: 10px 15px;
    font-size: 16px;
    border-radius: 8px;
    width: 100%;
    font-weight: bold;
  }

  .reservation-card .btn-reserve:hover {
    background: #e03339;
  }

  .divider {
    border-top: 1px solid #5c5b5b;
    margin: 10px 0;
  }

  .price-detail {
    font-size: 14px;
  }

  .total-price {
    font-weight: bold;
    font-size: 16px;
  }

  .text-muted {
    font-size: 13px;
  }

  /*Offers*/
  .offers{
    display: flex;
    align-items: center;
  }
  .offers i{
    font-size: 22px;
    color: #393838;
    margin-right: 20px;
  }
  .offers .para{
    font-size: 16px;
    font-weight: 300;
  }

.host-card {
    width: 320px;
    border: none;
    border-radius: 15px;
    box-shadow: rgba(14, 30, 37, 0.12) 0px 2px 4px 0px, rgba(14, 30, 37, 0.32) 0px 2px 16px 0px;
}
.host-card img {
    border-radius: 50%;
    width: 100px;
    height: 100px;
    object-fit: cover;
}
.verified-badge {
    position: absolute;
    bottom: 10px;
    right: 90px;
    background-color: #ff4d67;
    color: white;
    border-radius: 50%;
    width: 25px;
    height: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 15px;
}

.host-container {
  display: flex;
  gap: 70px;
  flex-wrap: wrap;
  align-items: flex-start;
}

.host-details {
  flex-grow: 1;
}

.host-details p{
  font-size: 15px;
}

.host-details .button {
  background: #000;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 14px;
  margin-top: 15px;
  transition: all 0.3s;
}

.host-details .button:hover {
  background: #333;
}

.host-details small {
  display: block;
  margin-top: 10px;
  color: #666;
  font-size: 12px;
}

.intro .bio{
  font-size: 17px;
  max-width: 600px;
}
.intro .bio i{
  margin-right: 10px;
}

</style>

<% layout("/layouts/boilerplate") %>

<!-- Main Container -->
<div class="container mt-3">
  <div class="row justify-content-center align-items-start">
    <div class="card-title mb-2 d-flex justify-content-between align-items-center">
      <!-- Title -->
      <h3 class="fs-3 mb-0">
        Quinta da Santana- Luxury Country Poolside Villa
      </h3>
      <!-- Share and Save Options -->
      <div class="share">
        <a href="#" class="text-dark me-3" id="shareButton">
          <i class="fa-solid fa-arrow-up-from-bracket"></i> Share
        </a>
        <a href="#" class="text-dark" id="saveButton">
          <i class="fa-regular fa-heart" id="heartIcon"></i> Save
        </a>
      </div>
    </div>
  </div>

  <!-- Listing Card -->
  <div class="col-md-12 offset-md mb-3">
    <div class="gallery-pic">
      <!-- Main image: Check if the image exists, else show a default image -->
      <img class="galleryOne" src="<%= listing.images.length > 0 && listing.images[0].url ? listing.images[0].url : 'https://via.placeholder.com/500x500.png?text=No+Image' %>" alt="listing-image">
      
      <div class="container2">
        <!-- Loop through remaining images, show fallback image if any image URL is missing -->
        <% listing.images.slice(1).forEach(image => { %>
          <img class="gallery" src="<%= image.url ? image.url : 'https://via.placeholder.com/500x500.png?text=No+Image' %>" alt="listing-image">
        <% }); %>
      </div>
    </div>
  </div>
  
  
    <!-- Modal -->
    <div id="imageModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <button id="prevBtn" class="nav-btn">❮</button>
        <img id="modalImage" src="" alt="Selected Image">
        <button id="nextBtn" class="nav-btn">❯</button>
      </div>
    </div>
  </div>
  
  <!-- Listing details -->
   <div class="d-flex">
    <div class="col-md-7 offset-md mb-4">
      <div class="details">
        <h1>Entire home in <%= listing.location %>, <%= listing.country %></h1>
        <p>8 guests · 3 bedrooms · 3 beds · 3 bathrooms</p>
        <p>Rating: <%= reviewCount > 0 ? `${averageRating} ★` : "No ratings yet" %></p>
        <a href="#reviews" class="review-link">
          <p class="review-count mb-4"><%= reviewCount %> Reviews</p>
        </a>
  
        <hr>
        <div class="host-info">
          <a href="#host-card" class="host-link">
          <img src="<%= listing.owner.profilePicture || '/image/user.jpg' %>" alt="Host">
          </a>
          <div>
            <p><strong>Hosted by <%= listing.owner.username %></strong></p>
            <p class="blockquote-footer">Hosting Since <%= new Date(listing.owner.createdAt).toLocaleString('default', { year: 'numeric' }) %></p>
          </div>
        </div>  
        <hr>
        <div class="mt-4 mb-5">
          <div class="container mb-5">
            <div class="row mb-3 align-items-start">
              <div class="col-auto">
                <i class="feature-icon fa-solid fa-fan"></i>
              </div>
              <div class="col">
                <h4 class="fs-6">Designed for staying cool</h4>
                <p class="text-muted mb-0 fs-7">
                  Beat the heat with the A/C and ceiling fan.
                </p>
              </div>
            </div>
            <div class="row mb-3 align-items-start">
              <div class="col-auto">
                <i class="feature-icon fa-solid fa-cloud-sun"></i>
              </div>
              <div class="col">
                <h4 class="fs-6">Amazing outdoor space</h4>
                <p class="text-muted mb-0 fs-7">
                  Guests mention the pool, garden and veranda as highlights.
                </p>
              </div>
            </div>
            <div class="row mb-3 align-items-start">
              <div class="col-auto">
                <i class="feature-icon fa-solid fa-wallet"></i>
              </div>
              <div class="col">
                <h4 class="fs-6">Free cancellation before 2 Jan</h4>
                <p class="text-muted mb-0 fs-7">
                  Get a full refund if you change your mind.
                </p>
              </div>
            </div>
          </div>
          <p class="fs-6 ">
            <%= listing.description %>
          </p>
        </div>
        <hr>
        <h1 class="mt-4 mb-4">What this place offers</h1>
        <div class="d-flex justify-content-between">
          <div>
            <div class="offers">
              <p><i class="fa-regular fa-image"></i></p>
              <p class="para">Valley View</p>
            </div>
            <div class="offers">
              <p><i class="fa-solid fa-wifi"></i></p>
              <p class="para">Wifi</p>
            </div>
            <div class="offers">
              <p><i class="fa-solid fa-car-rear"></i></p>
              <p class="para">Free parking on premises</p>
            </div>
            <div class="offers">
              <p><i class="fa-solid fa-tv"></i></p>
              <p class="para">TV</p>
            </div>
            <div class="offers">
              <p><i class="fa-solid fa-virus-covid"></i></p>
              <p class="para text-decoration-line-through">Carbon monoxide alarm</p>
            </div>
          </div>
          <div>
            <div class="offers">
              <p><i class="fa-solid fa-tree-city"></i></p>
              <p class="para">Park view</p>
            </div>
            <div class="offers">
              <p><i class="fa-solid fa-network-wired"></i></p>
              <p class="para">Dedicated workspace</p>
            </div>
            <div class="offers">
              <p><i class="fa-solid fa-network-wired"></i></p>
              <p class="para">Private outdoor pool – open specific hours</p>
            </div>
            <div class="offers">
              <p><i class="fa-solid fa-user-secret"></i></p>
              <p class="para">Exterior security cameras on property</p>
            </div>
            <div class="offers">
              <p><i class="fa-solid fa-ban-smoking"></i></p>
              <p class="para text-decoration-line-through">Smoke alarm</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="reservation-card">
      <div class="d-flex align-items-center">
        <span class="price-discount" id="price-discount"></span>
        <span class="price" id="price">&#8377; <%= listing.price.toLocaleString("en-IN") %></span>
        <span class="text-muted">/ night</span>
      </div>
      <div class="d-flex mt-3 dates">
        <div class="w-50 pe-2">
          <label for="checkin" class="form-label text-muted">Check-in</label>
          <input type="date" id="checkin" class="form-control" value="2024-12-11">
        </div>
        <div class="w-50 ps-2">
          <label for="checkout" class="form-label text-muted">Check-out</label>
          <input type="date" id="checkout" class="form-control" value="2024-12-12">
        </div>
      </div>
      <div class="mt-3">
        <label for="guests" class="form-label text-muted">Guests</label>
        <select id="guests" class="form-select">
          <option value="1">1 guest</option>
          <option value="2">2 guests</option>
          <option value="3" selected>3 guests</option>
          <option value="4">4 guests</option>
        </select>
      </div>
      <button class="btn-reserve mt-4">Reserve</button>
      <p class="text-muted text-center mt-2">You won't be charged yet</p>
      <hr class="divider">
      <div class="d-flex justify-content-between price-detail">
        <span id="price-detail-text">₹<%= listing.price.toLocaleString("en-IN") %> x 1 nights</span>
        <span id="price-detail-total"></span>
      </div>
      <div class="d-flex justify-content-between price-detail">
        <span>Cleaning fee</span>
        <span id="cleaning-fee">₹349</span>
      </div>
      <div class="d-flex justify-content-between price-detail">
        <span>Airbnb service fee</span>
        <span id="service-fee">₹1,000</span>
      </div>
      <hr class="divider">
      <div class="d-flex justify-content-between total-price">
        <span>Total before taxes</span>
        <span id="total-price"></span>
      </div>
    </div>  
  </div>
  <% if(currentUser && currentUser._id.equals(listing.owner._id)) { %>
  <div class="mb-5 button">
    <a
      href="/listings/<%= listing._id %>/edit"
      class="btn btn-outline-primary btn-md px-2 py-2 me-3"
    >
      <i class="fas fa-edit"></i> Edit Listing
    </a>
    <form
      method="POST"
      action="/listings/<%= listing._id %>?_method=DELETE"
      class="d-inline-block"
    >
      <button class="btn btn-outline-danger btn-md px-2 py-2">
        <i class="fas fa-trash-alt"></i> Delete Listing
      </button>
    </form>
  </div>
  <% } %>
  <hr>

  <!-- Review Section -->
  <div class="col-md-8 offset-md mb-5">
    <h4 class="mb-4 text-uppercase">Leave a Review</h4>
    <form
      action="/listings/<%= listing.id %>/reviews"
      method="POST"
      class="needs-validation"
    >
      <div class="">
        <label for="rating" class="form-label">Give Your Star</label>
        <fieldset class="starability-slot">
          <input
            type="radio"
            id="no-rate"
            class="input-no-rate"
            name="review[rating]"
            value="1"
            checked
          />
          <input
            type="radio"
            id="first-rate1"
            name="review[rating]"
            value="1"
          />
          <label for="first-rate1" title="Terrible">1 star</label>
          <input
            type="radio"
            id="first-rate2"
            name="review[rating]"
            value="2"
          />
          <label for="first-rate2" title="Not good">2 stars</label>
          <input
            type="radio"
            id="first-rate3"
            name="review[rating]"
            value="3"
          />
          <label for="first-rate3" title="Average">3 stars</label>
          <input
            type="radio"
            id="first-rate4"
            name="review[rating]"
            value="4"
          />
          <label for="first-rate4" title="Very good">4 stars</label>
          <input
            type="radio"
            id="first-rate5"
            name="review[rating]"
            value="5"
          />
          <label for="first-rate5" title="Amazing">5 stars</label>
        </fieldset>
      </div>
      <div class="mb-3">
        <label for="comment" class="form-label">Your Comments</label>
        <textarea
          name="review[comment]"
          id="comment"
          cols="30"
          rows="5"
          class="form-control border-primary"
          required
        ></textarea>
      </div>
      <button type="submit" class="btn btn-primary btn-md btn-block w-10">
        Submit Review
      </button>
    </form>
  </div>
  <% if (listing.reviews.length > 0) { %>
    <div id="reviews" class="reviews-container mt-5 mb-5">
      <h4 class="mb-4 text-uppercase">All Reviews</h4>
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <!-- Loop through reviews and display only the first 9-12 -->
        <% for (let i = 0; i < Math.min(listing.reviews.length, 9); i++) { %>
          <div class="col">
            <div class="h-100 p-3 review-card">
              <div class="d-flex align-items-center mb-3">
                <img src="<%= listing.reviews[i].author.profilePicture || '/image/user.jpg' %>" alt="Avatar" class="rounded-circle me-3" width="50" height="50" />
                <div>
                  <h5 class="mb-0">@<%= listing.reviews[i].author.name %></h5>
                  <p class="text-muted small">From - <%= new Date(listing.reviews[i].author.createdAt).toLocaleString('default', { month: 'short', year: 'numeric' }) %> on this platform</p>
                </div>
              </div>
              <p class="mb-1">
                <span class="fw-bold text-warning"><%= listing.reviews[i].rating %> ★</span> - <%= new Date(listing.reviews[i].createdAt).toLocaleString('default', { day: 'numeric', month: 'short', year: 'numeric' }) %>
              </p>
              <p class="card-text text-muted">
                <span class="short-text"><%= listing.reviews[i].comment.substring(0, 100) %>....</span>
                <span class="full-text d-none"><%= listing.reviews[i].comment %></span>
              </p>
              <button class="btn btn-link p-0 text-primary show-more" data-id="<%= listing.reviews[i]._id %>">Show more</button>
              <% if (currentUser && currentUser._id.equals(listing.reviews[i].author._id)) { %>
                <form method="post" action="/listings/<%= listing._id %>/reviews/<%= listing.reviews[i]._id %>?_method=DELETE" class="mt-3">
                  <button class="btn btn-danger btn-sm">Delete</button>
                </form>
              <% } %>
            </div>
          </div>
        <% } %>
      </div>
  
      <!-- Show All Reviews Button -->
      <% if (listing.reviews.length > 9) { %>
        <button class="btn btn-primary mt-4" id="show-all-reviews">Show All Reviews</button>
      <% } %>
  
      <!-- Modal for showing all reviews -->
      <div class="modal" tabindex="-1" id="reviews-modal">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">All Reviews</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="reviews-modal-container">
                <!-- All reviews are loaded dynamically -->
              </div>
              <!-- Pagination controls -->
              <div class="text-center mt-3">
                <button id="prev-page" class="btn btn-secondary" disabled>Previous</button>
                <button id="next-page" class="btn btn-secondary">Next</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% } %>
  
  <hr>
   

  <div class="col-md-12 offset-md mb-5">
    <h3 class="text-uppercase mb-4">Where You'll Be</h3>
    <div
      id="map"
      style="
        height: 500px;
        border-radius: 5px;
      "
      >
    </div>
  </div>
  <hr>
  <div id="host-card" class="mb-5">
      <h1 class="fs-3 mb-4">Meet your Host</h1>
      <div class="host-container">
          <div class="host-card text-center p-3">
            <div class="position-relative mx-auto">
                <a href="/profile/<%= listing.owner._id %>"><img src="<%= listing.owner.profilePicture || '/image/user.jpg' %>" alt="Host Profile Picture" class="img-fluid"></a>
                <div class="verified-badge">✔</div>
            </div>
            <h5 class="mt-3 mb-1 fs-3"><%= listing.owner.name %></h5>
            <p class="text-muted fs-6">Host</p>
            <div class="d-flex justify-content-between mt-3 px-3">
                <div>
                    <h6 class="mb-0 fs-5"><%= reviewCount %></h6>
                    <small class="text-muted">Reviews</small>
                </div>
                <div>
                    <h6 class="mb-0 fs-5"><%= reviewCount > 0 ? `${averageRating}` : "1" %><span class="text-warning">★</span></h6>
                    <small class="text-muted">Rating</small>
                </div>
                <div>
                    <h6 class="mb-0 fs-5">
                      <%= new Date().getFullYear() - new Date(listing.owner.createdAt).getFullYear() %>
                    </h6>
                    <small class="text-muted">Years hosting</small>
                </div>
            </div>
          </div>

        <!-- Host Details -->
          <div class="host-details">
            <h2 class="fs-4 mb-3">Host Details</h2>
            <p>Response rate: 92%</p>
            <p>Responds within a few hours</p>
            <a class="text-decoration-none" href="tel:+91-9835854042"><button class="button">Message Host</button></a>
            <hr>
            <small>
              <i class="fas fa-user-secret fs-4"></i> To protect your payment, never transfer money or communicate outside of the platform.
            </small>
          </div>
      </div>

      <div class="mt-4 intro">
        <p class="bio"><i class="fa-brands fa-teamspeak fs-4"></i> Speaks English and Hindi</p>
        <p class="bio"><i class="fa-solid fa-earth-asia fs-4"></i> Lives in <%= listing.owner.address.state %>, <%= listing.owner.address.country %></p>
        <p class="bio mt-4"><%= listing.owner.bio.substring(0, 100) %>....</p>
        <a class="text-info" href="/profile/<%= listing.owner._id %>">Show more ></a>
      </div>
</div>

<script>
  var map, encoded_polyline;
  function initMap1() {
    map = new mappls.Map("map", {
      center: [77.209, 28.6139],
      zoom: 9,
      location: true,
    });
    map.addListener("load", function () {
      var encodedString =
        "absmDmnjvM?BJ|@MFUa@GKIIOQIGUKi@QYAuBIwBIyBEyBEw@PYFQJSLKJIHEJiA~BgA`C}A`DDFDFBFBL?LAF?DELCDIHKDEBK?G?IvDIhEAh@C`ACpAC~ACz@C`BAR?TAr@Al@AjAAz@ARHn@D@BFDH@D?HAHCFCDCBEDQx@Ax@I|D?b@EtAAn@Ad@CjA?REzAAr@CvAAd@AZGfEALAZN@NFDBJHHNBHDL@RCTADCJEFCF";
      encoded_polyline = new mappls.Polyline({
        map: map,
        paths: encodedString,
        strokeColor: "blue",
        strokeOpacity: 1.0,
        strokeWeight: 5,
        editable: true,
        fitbounds: true,
      });
    });
  }

var currentImageIndex = 0; // Initialize current image index
var images = document.querySelectorAll(".gallery, .galleryOne");
var modal = document.getElementById("imageModal");
var modalImage = document.getElementById("modalImage");
var closeModal = modal.querySelector(".close");
var prevBtn = document.getElementById('prevBtn');
var nextBtn = document.getElementById('nextBtn');

// Add click event listener to each image
images.forEach((img, index) => {
  img.addEventListener("click", () => {
    modal.style.display = "flex";
    modalImage.src = img.src; // Set modal image source to clicked image
    currentImageIndex = index; // Set the current index to clicked image
  });
});

// Close modal when 'X' is clicked
closeModal.addEventListener("click", () => {
  modal.style.display = "none";
});

// Close modal when clicking outside the image
window.addEventListener("click", (e) => {
  if (e.target === modal) {
    modal.style.display = "none";
  }
});


// Navigate to previous image
prevBtn.addEventListener('click', () => {
  currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
  modalImage.src = images[currentImageIndex].src;
});

// Navigate to next image
nextBtn.addEventListener('click', () => {
  currentImageIndex = (currentImageIndex + 1) % images.length;
  modalImage.src = images[currentImageIndex].src;
});


//Read more Button in Review
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".show-more").forEach((button) => {
      button.addEventListener("click", (event) => {
        const reviewCard = event.target.closest(".review-card");
        const shortText = reviewCard.querySelector(".short-text");
        const fullText = reviewCard.querySelector(".full-text");

        if (fullText.classList.contains("d-none")) {
          // Show full text
          shortText.classList.add("d-none");
          fullText.classList.remove("d-none");
          event.target.textContent = "Show less";
        } else {
          // Show truncated text
          shortText.classList.remove("d-none");
          fullText.classList.add("d-none");
          event.target.textContent = "Show more";
        }
      });
    });
  });

  //Price Discount
  const priceElement = document.getElementById('price');
    const priceDiscountElement = document.getElementById('price-discount');

    function updateDiscountPrice() {
      const priceText = priceElement.textContent.replace('₹', '').replace(',', '');
      const price = parseInt(priceText, 10);
      if (!isNaN(price)) {
        const discountPrice = price + 1000;
        priceDiscountElement.textContent = `₹${discountPrice.toLocaleString()}`;
      }
    }

    // Update the discount price on page load
    updateDiscountPrice();

    //Review navigate
    document.querySelector('.review-link , .host-link').addEventListener('click', function (e) {
      e.preventDefault();
      document.querySelector('#reviews , #host-card').scrollIntoView({
        behavior: 'smooth'
      });
    });

    //Review Modal Js
    document.addEventListener('DOMContentLoaded', function() {
      const showAllReviewsButton = document.getElementById('show-all-reviews');
      const reviewsModal = new bootstrap.Modal(document.getElementById('reviews-modal'));
      const reviewsContainer = document.getElementById('reviews-modal-container');
      const prevButton = document.getElementById('prev-page');
      const nextButton = document.getElementById('next-page');
    
      let currentPage = 1;
      const reviewsPerPage = 9;
      
      // Initialize reviews in modal (first batch of reviews)
      function loadReviews(page = 1) {
        const start = (page - 1) * reviewsPerPage;
        const end = start + reviewsPerPage;
    
        // Get the reviews (assuming reviews are stored in a JavaScript array on the page)
        const reviews = <%- JSON.stringify(listing.reviews) %>;
        const reviewsToShow = reviews.slice(start, end);
    
        // Clear existing reviews in the modal
        reviewsContainer.innerHTML = '';
    
        // Append reviews to modal
        reviewsToShow.forEach(review => {
          const reviewCard = document.createElement('div');
          reviewCard.classList.add('col');
          reviewCard.innerHTML = `
            <div class="h-100 p-3 review-card">
              <div class="d-flex align-items-center mb-3">
                <img src="${review.author.profilePicture || '/image/user.jpg'}" alt="Avatar" class="rounded-circle me-3" width="50" height="50" />
                <div>
                  <h5 class="mb-0">@${review.author.name}</h5>
                  <p class="text-muted small">From - ${new Date(review.author.createdAt).toLocaleString('default', { month: 'short', year: 'numeric' })} on this platform</p>
                </div>
              </div>
              <p class="mb-1">
                <span class="fw-bold text-warning">${review.rating} ★</span> - ${new Date(review.createdAt).toLocaleString('default', { day: 'numeric', month: 'short', year: 'numeric' })}
              </p>
              <p class="card-text text-muted">
                <span class="short-text">${review.comment}</span>
              </p>
              <button class="btn btn-link p-0 text-primary show-more" data-id="${review._id}">Show more</button>
            </div>
          `;
          reviewsContainer.appendChild(reviewCard);
        });
    
        // Update button states based on the page
        prevButton.disabled = currentPage === 1;
        nextButton.disabled = end >= reviews.length;
      }
    
      // Show all reviews modal
      if (showAllReviewsButton) {
        showAllReviewsButton.addEventListener('click', function() {
          reviewsModal.show();
          loadReviews(currentPage);
        });
      }
    
      // Pagination buttons functionality
      prevButton.addEventListener('click', function() {
        if (currentPage > 1) {
          currentPage--;
          loadReviews(currentPage);
        }
      });
    
      nextButton.addEventListener('click', function() {
        currentPage++;
        loadReviews(currentPage);
      });
    });

    //Share function
    document.getElementById('shareButton').addEventListener('click', function (event) {
      event.preventDefault();
      const shareText = 'Check out Quinta da Santana- Luxury Country Poolside Villa!';
      const currentUrl = window.location.href; // Current page URL or a specific listing URL

      if (navigator.share) {
        // Browser supports Web Share API
        navigator.share({
          title: 'Quinta da Santana Villa',
          text: shareText,
          url: currentUrl, // Use the current URL of the page
        })
          .then(() => console.log('Share was successful'))
          .catch((error) => console.log('Share failed', error));
      } else {
        // Fallback if Web Share API is not supported
        alert('Your browser does not support sharing. Copy the link to share.');
      }
    });

    // fee calculation
     // Define constants for fees
  const cleaningFee = 349;
  const serviceFee = 1390;

  // Function to calculate the total price
  function calculateTotalPrice() {
    // Get the selected check-in and check-out dates
    const checkinDate = document.getElementById('checkin').value;
    const checkoutDate = document.getElementById('checkout').value;
    const guests = document.getElementById('guests').value;
    const pricePerNight = <%= listing.price %>;

    // Calculate the number of nights
    const checkin = new Date(checkinDate);
    const checkout = new Date(checkoutDate);
    const nightDifference = Math.ceil((checkout - checkin) / (1000 * 3600 * 24));

    // Calculate the total price for nights
    const totalPriceForNights = pricePerNight * nightDifference;

    // Update the displayed prices
    document.getElementById('price-detail-text').innerText = `₹${pricePerNight.toLocaleString('en-IN')} x ${nightDifference} night${nightDifference > 1 ? 's' : ''}`;
    document.getElementById('price-detail-total').innerText = `₹${totalPriceForNights.toLocaleString('en-IN')}`;

    // Calculate the total price before taxes
    const totalBeforeTaxes = totalPriceForNights + cleaningFee + serviceFee;

    // Update the total price
    document.getElementById('total-price').innerText = `₹${totalBeforeTaxes.toLocaleString('en-IN')}`;
  }

  // Event listeners to update total price when dates or guests change
  document.getElementById('checkin').addEventListener('change', calculateTotalPrice);
  document.getElementById('checkout').addEventListener('change', calculateTotalPrice);
  document.getElementById('guests').addEventListener('change', calculateTotalPrice);

  // Initial calculation on page load
  calculateTotalPrice();
    
</script>
<script src="/js/tax.js"></script>
